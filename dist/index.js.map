{"version":3,"file":"index.js","sources":["../src/utils.js","../src/hook-builder.js","../src/combine.js","../src/hooks/with-imperative-handle.js","../src/hooks/with-callbacks.js","../src/hooks/with-state-handlers.js","../src/hooks/with-layout-effect.js","../src/hooks/with-async-effect.js","../src/hooks/with-debug-value.js","../src/hooks/with-memo.js","../src/hooks/with-context.js","../src/hooks/with-reducer.js","../src/hooks/with-effect.js","../src/hooks/with-state.js","../src/hooks/with-ref.js"],"sourcesContent":["const CTOR_PATTERN = /\\[object\\s(\\w+)\\]/;\nconst baseToString = Object.prototype.toString\n\nexport const getInternalCtor = (value) => {\n  const fullTypeDesc = baseToString.call(value)\n  const [, internalClass] = fullTypeDesc.match(CTOR_PATTERN)\n\n  return internalClass\n}\n\nexport const isFunction = fn => getInternalCtor(fn) === 'Function'\nexport const isObject = obj => getInternalCtor(obj) === 'Object'\n\nexport const isPromiseLike = value => value && (\n  getInternalCtor(value) === 'Promise' ||\n    (isFunction(value.then) && isFunction(value.catch))\n)\n\nexport const compose = (...fns) => (\n  fns.reduce((prevFn, nextFn) => (\n    (...args) => prevFn(nextFn(...args))\n  ))\n)\n\nexport const isCombineConfigMode = args => isObject(args[0])\n\nexport const unwindLoop = (useCustomHook, funcDescriptions) => {\n  const FuncCtor = Function\n  const invocations = Object.entries(funcDescriptions)\n    .map(([key]) => `box.${key} = useCustomHook(fns.${key}, deps, state, props);`)\n    .join('\\n')\n\n  const body = `\n    const box = {};\n    ${invocations}\n    return box\n  `\n\n  return new FuncCtor('useCustomHook', 'fns', 'deps', 'state', 'props', body)\n    .bind(null, useCustomHook, funcDescriptions)\n}\n\nexport const prop = (obj, path) => {\n  if (obj == null) {\n    return obj\n  }\n\n  let value = obj\n  const parts = path.split('.')\n\n  for (const part of parts) {\n    value = value && value[part]\n\n    if (!value) {\n      return undefined\n    }\n  }\n\n  return value\n}\n\nexport const getDeps = (source, depsNames) => (Array.isArray(depsNames) ?\n  depsNames.map(dep => prop(source, dep)) :\n  depsNames)\n\nexport const defaultProps = props => (Component) => {\n  if (typeof props !== 'object') {\n    throw Error(`defaultProps expects object, got a ${getInternalCtor(props)}`)\n  }\n\n  // eslint-disable-next-line\n  Component.defaultProps = props\n\n  return Component\n}\n\nexport const identity = value => value\n\n// eslint-disable-next-line\nexport const flow = (...callbacks) => Component => callbacks.reduce((Component, callback) => callback(Component), Component)\n","import { isFunction } from './utils'\n\nexport const hookBuilder = (combineFuncs) => {\n  const blackSheepIndex = combineFuncs.findIndex(fn => !isFunction(fn))\n\n  if (blackSheepIndex !== -1) {\n    throw Error(`\n      Expected function,\n      got a: ${typeof combineFuncs[blackSheepIndex]}\n      on index: ${blackSheepIndex}\n    `)\n  }\n\n  const FuncCtor = Function\n\n  const body = combineFuncs.map((_fn, index) => `\n    const result${index} = funcs[${index}](state${index}, props) || {}\n    const state${index + 1} = Object.setPrototypeOf(result${index}, state${index});\n  `).join('\\n')\n\n  const template = `\n    const state0 = {};\n    ${body}\n    return state${combineFuncs.length};\n  `\n\n  return new FuncCtor('funcs', 'props', template)\n    .bind(null, combineFuncs)\n}\n","import React from 'react'\n\nimport { hookBuilder } from './hook-builder'\n\nimport {\n  isCombineConfigMode,\n  defaultProps as withDefaultProps,\n  identity,\n  flow\n} from './utils'\n\nconst combineFromConfig = (config, Component) => {\n  const { hooks, hocs, defaultProps, transformProps } = Object.assign({\n    hooks: [],\n    hocs: [],\n    transformProps: identity,\n  }, config)\n\n  const hooksComposition = hookBuilder(hooks)\n\n  if (defaultProps) {\n    withDefaultProps(defaultProps)(Component)\n  }\n\n  const ExtendedComponent = (props) => {\n    const state = hooksComposition(props)\n    return <Component {...transformProps({ ...state, ...props })} />\n  }\n\n  return flow(...hocs)(ExtendedComponent)\n}\n\nexport const combine = (...hooks) => (Component) => {\n  const ExtendedComponent = isCombineConfigMode(hooks) ?\n    combineFromConfig(hooks[0], Component) :\n    combineFromConfig({ hooks }, Component)\n\n  ExtendedComponent.displayName = `${Component.displayName || Component.name}Hooked`\n\n  return ExtendedComponent\n}\n","import { useImperativeHandle } from 'react'\n\nimport { getDeps } from '../utils'\n\nexport const withImperativeHandle = (ref, createHandler, dependencies) => (state, props) => {\n  const deps = getDeps({ ...state, ...props }, dependencies)\n  useImperativeHandle(ref, () => createHandler(state, props), deps)\n}\n","import { useCallback } from 'react'\n\nimport { getDeps, unwindLoop, isFunction } from '../utils'\n\nexport const withCallbacks = (callbacks, dependencies) => {\n  const unrolledCalls = unwindLoop((fnCfg, deps, state, props) => {\n    const activeFn = isFunction(fnCfg) ? fnCfg : fnCfg.func\n    const activeDeps = getDeps({ ...state, ...props }, fnCfg.deps || deps)\n    return useCallback(activeFn(state, props), activeDeps)\n  }, callbacks)\n\n  return (state, props) => unrolledCalls(dependencies, state, props)\n}\n\nexport const withCallback = (callbackName, callback, dependencies) => (state, props) => {\n  const deps = getDeps({ ...state, ...props }, dependencies)\n  return { [callbackName]: useCallback(callback(state, props), deps) }\n}\n","import { useState } from 'react'\n\nimport { isFunction, compose } from '../utils'\n\n// TODO: get state as lazy func\n// TODO: updater -> should not react\n// Revise this method !!!\nexport const withStateHandlers = (getState, actionHandlers) => (state, props) => {\n  const initialState = isFunction(getState) ? getState(state, props) : getState\n  const [localState, updater] = useState(initialState)\n  const actionHandlersWithState = {}\n  const assignToState = updatedStatePart => updater({ ...localState, ...updatedStatePart })\n\n  for (const [key, actionHandler] of Object.entries(actionHandlers)) {\n    actionHandlersWithState[key] = compose(\n      assignToState,\n      actionHandler(localState)\n    )\n  }\n\n  return { ...localState, ...actionHandlersWithState }\n}\n","import { useLayoutEffect } from 'react'\n\nimport { getDeps } from '../utils'\n\nexport const withLayoutEffect = (fn, dependencies) => (state, props) => {\n  const deps = getDeps({ ...state, ...props }, dependencies)\n  useLayoutEffect(() => fn(state, props), deps)\n}\n","import { useEffect, useState } from 'react'\n\nimport { getDeps, isPromiseLike, getInternalCtor } from '../utils'\n\nexport const withAsyncEffect = params => (state, props) => {\n  const { asyncAction, disposeAction, deps } = params\n  const [innerState, setData] = useState({ loading: true, data: null, error: null })\n\n  useEffect(() => {\n    setData({ data: innerState.data, error: null, loading: true })\n\n    const promise = asyncAction(state, props)\n\n    if (!isPromiseLike(promise)) {\n      throw Error(`withAsyncEffect expects Promise, got a: ${getInternalCtor(promise)}`)\n    }\n\n    promise.then((result) => {\n      setData({ loading: false, data: result, error: null })\n    }, (error) => {\n      setData({ loading: false, data: innerState.data, error })\n    })\n\n    return disposeAction\n  }, getDeps({ ...state, ...props }, deps))\n\n  return innerState\n}\n","import { useDebugValue } from 'react'\n\nexport const withDebugValue = (valueExtractor, formatter) => (state, props) => {\n  const status = valueExtractor(state, props)\n  useDebugValue(status, formatter)\n}\n","import { useMemo } from 'react'\n\nimport { getDeps, unwindLoop, isFunction } from '../utils'\n\nexport const withMemos = (funcs, dependencies) => {\n  const unrolledLoop = unwindLoop((fnCfg, deps, state, props) => {\n    const activeFn = isFunction(fnCfg) ? fnCfg : fnCfg.func\n    const activeDeps = getDeps({ ...state, ...props }, fnCfg.deps || deps)\n    return useMemo(() => activeFn(state, props), activeDeps)\n  }, funcs)\n\n  return (state, props) => unrolledLoop(dependencies, state, props)\n}\n\nexport const withMemo = (memoizedName, callback, deps) => (state, props) => {\n  const memoizedValue = useMemo(\n    () => callback(state, props),\n    getDeps({ ...state, ...props }, deps)\n  )\n\n  return { [memoizedName]: memoizedValue }\n}\n","import { useContext } from 'react'\n\nexport const withContext = (contextName, Context) => () => {\n  const context = useContext(Context)\n  return { [contextName]: context }\n}\n","import { useReducer } from 'react'\n\nexport const withReducer = (config) => {\n  const {\n    reducer,\n    stateName,\n    dispatchName,\n    initialState,\n    init,\n  } = { dispatchName: 'dispatch', ...config }\n\n  return () => {\n    const [state, dispatch] = useReducer(reducer, initialState, init)\n    return { [stateName]: state, [dispatchName]: dispatch }\n  }\n}\n","import { useEffect } from 'react'\n\nimport { getDeps } from '../utils'\n\nexport const withEffect = (fn, dependencies) => (state, props) => {\n  const deps = getDeps({ ...state, ...props }, dependencies)\n  useEffect(() => fn(state, props), deps)\n}\n","import { useState } from 'react'\n\nimport { isFunction } from '../utils'\n\nexport const withState = (stateName, handler, initialState) => {\n  const initState = isFunction(initialState) ?\n    (state, props) => () => initialState(state, props) :\n    () => initialState\n\n  return (state, props) => {\n    const [innerState, updater] = useState(initState(state, props))\n    return { [stateName]: innerState, [handler]: updater }\n  }\n}\n","import { useRef } from 'react'\n\nexport const withRef = (refName, initialValue) => () => {\n  const ref = useRef(initialValue)\n  return { [refName]: ref }\n}\n"],"names":["CTOR_PATTERN","baseToString","Object","prototype","toString","getInternalCtor","value","call","match","isFunction","fn","isObject","obj","isPromiseLike","then","compose","fns","reduce","prevFn","nextFn","isCombineConfigMode","args","unwindLoop","useCustomHook","funcDescriptions","FuncCtor","Function","invocations","entries","map","key","join","bind","prop","path","parts","split","part","getDeps","source","depsNames","Array","isArray","dep","defaultProps","props","Component","_typeof","Error","identity","flow","callbacks","callback","hookBuilder","combineFuncs","blackSheepIndex","findIndex","body","_fn","index","length","combineFromConfig","config","assign","hooks","hocs","transformProps","hooksComposition","withDefaultProps","state","React","combine","ExtendedComponent","displayName","name","withImperativeHandle","ref","createHandler","dependencies","deps","useImperativeHandle","withCallbacks","unrolledCalls","fnCfg","activeFn","func","activeDeps","useCallback","withCallback","callbackName","withStateHandlers","getState","actionHandlers","initialState","useState","localState","updater","actionHandlersWithState","assignToState","updatedStatePart","actionHandler","withLayoutEffect","useLayoutEffect","withAsyncEffect","params","asyncAction","disposeAction","loading","data","error","innerState","setData","useEffect","promise","result","withDebugValue","valueExtractor","formatter","status","useDebugValue","withMemos","funcs","unrolledLoop","useMemo","withMemo","memoizedName","memoizedValue","withContext","contextName","Context","context","useContext","withReducer","dispatchName","reducer","stateName","init","useReducer","dispatch","withEffect","withState","handler","initState","withRef","refName","initialValue","useRef"],"mappings":"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"}